<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×¡×™×›×•× ×ª×©×œ×•×</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; direction: rtl; text-align: center; }
        .box { max-width: 450px; margin: auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .item-list { text-align: right; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 15px; }
        .item { display: flex; justify-content: space-between; margin: 8px 0; }
        
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1rem; }
        
        .method-box { display: flex; gap: 10px; margin: 15px 0; }
        .method-btn { flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; background: white; font-weight: bold; }
        .method-btn.active { border-color: #28a745; background: #f0fdf4; color: #28a745; }

        /* ×˜×•×¤×¡ ××©×¨××™ */
        #creditCardForm { display: none; background: #f9f9f9; padding: 15px; border-radius: 10px; margin-top: 15px; border: 1px solid #eee; }
        .card-row { display: flex; gap: 10px; }

        .tip-container { display: none; margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px; }
        .tip-label { font-size: 0.9rem; color: #666; display: block; margin-bottom: 5px; }
        #tipInput { background: #fffcf0; border-color: #ffeeba; }

        .total-area { font-size: 1.4rem; font-weight: bold; margin: 20px 0; color: #333; }
        .btn { background: #28a745; color: white; padding: 15px; width: 100%; border: none; border-radius: 10px; cursor: pointer; font-size: 1.2rem; font-weight: bold; }
    </style>
</head>
<body>

<div class="box">
    <h2>×¡×™×›×•× ×”×–×× ×” ğŸ›’</h2>
    
    <div id="list" class="item-list"></div>

    <input type="text" id="name" placeholder="×©× ××œ×">
    <input type="text" id="addr" placeholder="×›×ª×•×‘×ª ×œ××©×œ×•×—">

    <h4>×‘×—×¨ ×©×™×˜×ª ×ª×©×œ×•×:</h4>
    <div class="method-box">
        <button class="method-btn" id="btnCash" onclick="setMethod('××–×•××Ÿ')">ğŸ’µ ××–×•××Ÿ</button>
        <button class="method-btn" id="btnCard" onclick="setMethod('××©×¨××™')">ğŸ’³ ×›×¨×˜×™×¡ ××©×¨××™</button>
    </div>

    <div id="creditCardForm">
        <input type="text" id="cardNumber" placeholder="××¡×¤×¨ ×›×¨×˜×™×¡ (16 ×¡×¤×¨×•×ª)" maxlength="16">
        <div class="card-row">
            <input type="text" id="cardExpiry" placeholder="×ª×•×§×£ (MM/YY)" maxlength="5">
            <input type="text" id="cardCvv" placeholder="CVV" maxlength="3">
        </div>
    </div>

    <div class="tip-container" id="tipArea">
        <span class="tip-label">×¤×¨×’×•×Ÿ ×œ×©×œ×™×—? (××•×¤×¦×™×•× ×œ×™)</span>
        <input type="text" id="tipInput" placeholder="×”×›× ×¡ ×¡×›×•× ×˜×™×¤..." onfocus="clearSymbol(this)" onblur="addSymbol(this)" oninput="updateTotal()">
    </div>

    <div class="total-area" id="finalTotal">×¡×”"×› ×œ×ª×©×œ×•×: â‚ª0</div>

    <button class="btn" onclick="send()">××©×¨ ×•×©×œ×— ×”×–×× ×”</button>
</div>

<script>
    const cart = JSON.parse(localStorage.getItem('currentCart')) || [];
    const listDiv = document.getElementById('list');
    let baseTotal = 0;
    let paymentMethod = "";

    cart.forEach(item => {
        baseTotal += parseFloat(item.price);
        listDiv.innerHTML += `<div class="item"><span>${item.name}</span><span>â‚ª${item.price}</span></div>`;
    });

    function setMethod(method) {
        paymentMethod = method;
        document.querySelectorAll('.method-btn').forEach(b => b.classList.remove('active'));
        
        const tipArea = document.getElementById('tipArea');
        const creditForm = document.getElementById('creditCardForm');

        if (method === '××–×•××Ÿ') {
            document.getElementById('btnCash').classList.add('active');
            tipArea.style.display = 'none';
            creditForm.style.display = 'none';
            document.getElementById('tipInput').value = "";
        } else {
            document.getElementById('btnCard').classList.add('active');
            tipArea.style.display = 'block';
            creditForm.style.display = 'block';
        }
        updateTotal();
    }

    function addSymbol(input) {
        let val = input.value.replace('â‚ª', '').trim();
        if (val && !isNaN(val)) input.value = 'â‚ª' + val;
    }

    function clearSymbol(input) {
        input.value = input.value.replace('â‚ª', '').trim();
    }

    function updateTotal() {
        let tipRaw = document.getElementById('tipInput').value.replace('â‚ª', '').trim();
        let tipValue = parseFloat(tipRaw) || 0;
        const finalSum = baseTotal + tipValue;
        document.getElementById('finalTotal').innerText = `×¡×”"×› ×œ×ª×©×œ×•×: â‚ª${finalSum.toFixed(2)}`;
    }

    async function send() {
        const name = document.getElementById('name').value;
        const addr = document.getElementById('addr').value;
        
        if(!name || !addr || !paymentMethod) return alert("× × ×œ××œ× ×¤×¨×˜×™× ×•×œ×‘×—×•×¨ ×©×™×˜×ª ×ª×©×œ×•×");

        if(paymentMethod === '××©×¨××™') {
            const cardNum = document.getElementById('cardNumber').value;
            if(cardNum.length < 16) return alert("× × ×œ×”×–×™×Ÿ ××¡×¤×¨ ×›×¨×˜×™×¡ ×ª×§×™×Ÿ");
        }

        let tipRaw = document.getElementById('tipInput').value.replace('â‚ª', '').trim();
        const tip = parseFloat(tipRaw) || 0;
        const finalSum = baseTotal + tip;

        const token = "8578283273:AAHMx_fq5wp6f_8qK5-gxCv0RpM9p3RpsJI"; 
        const cid = "5855748133";
        
        const message = `ğŸ“¦ *×”×–×× ×” ×—×“×©×”!*\nğŸ‘¤ *×©×:* ${name}\nğŸ  *×›×ª×•×‘×ª:* ${addr}\nğŸ’³ *×ª×©×œ×•×:* ${paymentMethod}\nğŸ’° *××•×¦×¨×™×:* â‚ª${baseTotal.toFixed(2)}\nğŸ›µ *×˜×™×¤:* â‚ª${tip.toFixed(2)}\nâœ… *×¡×”"×›:* â‚ª${finalSum.toFixed(2)}`;

        try {
            await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chat_id: cid, text: message, parse_mode: "Markdown" })
            });
            alert("×”×”×–×× ×” ×”×ª×§×‘×œ×”! × ×ª×¨××” ×‘×§×¨×•×‘.");
            localStorage.removeItem('currentCart');
            window.location.href = 'index.html';
        } catch(e) { alert("×©×’×™××” ×‘×©×œ×™×—×”"); }
    }

    updateTotal();
</script>

</body>
</html>